<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Panel - Timetable Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.05);
            --hover-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
        }
        .navbar-brand i { margin-right: 10px; }
        .main-container { max-width: 1200px; margin: 0 auto; }
        .card { border-radius: 12px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
        .card:hover { box-shadow: var(--hover-shadow); transform: translateY(-3px); }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .btn-action { display: flex; align-items: center; gap: 6px; font-weight: 500; }
        .stats-card { text-align:center; padding:25px 15px; border-radius:12px; color:white; margin-bottom:20px; }
        .stats-card i { font-size:2rem; margin-bottom:10px; opacity:0.9; }
        .timetable-item { display:flex; justify-content:space-between; align-items:center; padding:15px; border-radius:8px; margin-bottom:10px; border-left:4px solid; transition: all 0.3s; }
        .timetable-content { flex:1; }
        .timetable-meta { display:flex; gap:15px; font-size:0.85rem; color:#6c757d; margin-top:5px; }
        .timetable-actions .btn { margin-left:5px; }
        .quick-actions { display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:15px; }
        .action-card { background:white; border-radius:10px; padding:20px; text-align:center; box-shadow:var(--card-shadow); cursor:pointer; transition: all 0.3s; }
        .action-card:hover { box-shadow: var(--hover-shadow); transform: translateY(-5px); }
        .action-card i { font-size:2rem; color: var(--primary-color); margin-bottom:10px; }
        .search-box { position: relative; margin-bottom: 20px; }
        .search-box input { padding-left:35px; border-radius:8px; }
        .search-box i { position:absolute; left:10px; top:10px; color:#6c757d; }
        @media(max-width:768px) { .quick-actions { grid-template-columns:1fr; } }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#"><i class="fas fa-calendar-alt"></i> Schedule Panel</a>
        <div class="d-flex align-items-center">
            <div class="user-info text-white me-3 d-none d-md-flex align-items-center">
                <div class="user-avatar me-2">US</div>
                <div>
                    <div class="fw-bold">User Name</div>
                    <small class="opacity-75">Schedule Manager</small>
                </div>
            </div>
            <a class="btn btn-outline-light" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>
</nav>

<div class="main-container my-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="h3 mb-1">Timetable Management</h2>
            <p class="text-muted mb-0">Create and manage your schedules efficiently</p>
        </div>
        <div class="btn-group">
            <button class="btn btn-outline-primary"><i class="fas fa-download"></i> Export</button>
            <a href="{% url 'create_timetable' %}" class="btn btn-primary"><i class="fas fa-plus"></i> Create Timetable</a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3"><div class="stats-card" style="background: linear-gradient(135deg,#4cc9f0,#4361ee)"><i class="fas fa-file-alt"></i><h3>{{ timetables|length }}</h3><p>Total Timetables</p></div></div>
        <div class="col-md-3"><div class="stats-card" style="background: linear-gradient(135deg,#ffc107,#ff9f1c)"><i class="fas fa-clock"></i><h3>{{ pending_count }}</h3><p>Pending</p></div></div>
        <div class="col-md-3"><div class="stats-card" style="background: linear-gradient(135deg,#28a745,#20c997)"><i class="fas fa-check-circle"></i><h3>{{ approved_count }}</h3><p>Approved</p></div></div>
        <div class="col-md-3"><div class="stats-card" style="background: linear-gradient(135deg,#dc3545,#e83e8c)"><i class="fas fa-times-circle"></i><h3>{{ rejected_count }}</h3><p>Rejected</p></div></div>
    </div>

    <!-- Latest Timetable -->
    {% if timetables %}
    <div class="card mb-4">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-1">Latest Timetable</h5>
                <p class="mb-0">{{ timetables.0.title }} by {{ timetables.0.created_by.username }}</p>
                <small class="text-muted">{{ timetables.0.created_at }}</small>
            </div>
            <div class="btn-group">
                <form method="post" action="{% url 'update_status' timetables.0.id 'Approved' %}" style="display:inline;">{% csrf_token %}<button type="submit" class="btn btn-success btn-action"><i class="fas fa-check"></i> Approve</button></form>
                <form method="post" action="{% url 'update_status' timetables.0.id 'Rejected' %}" style="display:inline;">{% csrf_token %}<button type="submit" class="btn btn-danger btn-action"><i class="fas fa-times"></i> Reject</button></form>
                <form method="post" action="{% url 'update_status' timetables.0.id 'Review' %}" style="display:inline;">{% csrf_token %}<button type="submit" class="btn btn-info btn-action"><i class="fas fa-eye"></i> Review</button></form>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="card mb-4">
        <div class="card-header"><h5 class="mb-0">Quick Actions</h5></div>
        <div class="card-body">
            <div class="quick-actions">
                <div class="action-card" onclick="location.href='{% url 'create_timetable' %}'"><i class="fas fa-plus-circle"></i><h5>Create New</h5><p>Create a new timetable from scratch</p></div>
                <div class="action-card"><i class="fas fa-copy"></i><h5>Duplicate</h5><p>Duplicate an existing timetable</p></div>
                <div class="action-card"><i class="fas fa-upload"></i><h5>Import</h5><p>Import timetable from file</p></div>
                <div class="action-card"><i class="fas fa-cog"></i><h5>Settings</h5><p>Configure timetable preferences</p></div>
            </div>
        </div>
    </div>

    <!-- History Section -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Timetable History</h5>
            <div class="d-flex">
                <div class="search-box me-2">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" placeholder="Search timetables...">
                </div>
                <form method="post" action="{% url 'clear_schedule_history' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Clear History</button>
                </form>
            </div>
        </div>
        <div class="card-body">
            {% if timetables %}
            <div class="list-group">
                {% for t in timetables %}
                <div class="timetable-item 
                    {% if t.status == 'Pending' %}border-warning bg-warning bg-opacity-10
                    {% elif t.status == 'Approved' %}border-success bg-success bg-opacity-10
                    {% elif t.status == 'Rejected' %}border-danger bg-danger bg-opacity-10
                    {% else %}border-info bg-info bg-opacity-10{% endif %}">
                    <div class="timetable-content">
                        <h6>{{ t.title|default:"Untitled" }}</h6>
                        <p>{{ t.content }}</p>
                        <div class="timetable-meta">
                            <span><i class="fas fa-user me-1"></i>{{ t.created_by.username }}</span>
                            <span><i class="fas fa-calendar me-1"></i>{{ t.created_at }}</span>
                        </div>
                    </div>
                    <div class="timetable-actions btn-group btn-group-sm">
                        <form method="post" action="{% url 'update_status' t.id 'Approved' %}">{% csrf_token %}<button type="submit" class="btn btn-success btn-action"><i class="fas fa-check"></i></button></form>
                        <form method="post" action="{% url 'update_status' t.id 'Rejected' %}">{% csrf_token %}<button type="submit" class="btn btn-danger btn-action"><i class="fas fa-times"></i></button></form>
                        <form method="post" action="{% url 'update_status' t.id 'Review' %}">{% csrf_token %}<button type="submit" class="btn btn-info btn-action"><i class="fas fa-eye"></i></button></form>
                        <button class="btn btn-outline-secondary btn-action"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger btn-action"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state text-center">
                <i class="fas fa-inbox"></i>
                <h4>No Timetables Yet</h4>
                <p class="mb-4">When you create timetables, they will appear here.</p>
                <a href="{% url 'create_timetable' %}" class="btn btn-primary"><i class="fas fa-plus"></i> Create Your First Timetable</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Search functionality
    const searchInput = document.querySelector('.search-box input');
    if(searchInput) {
        searchInput.addEventListener('input', function() {
            const term = this.value.toLowerCase();
            document.querySelectorAll('.timetable-item').forEach(item => {
                item.style.display = item.textContent.toLowerCase().includes(term) ? 'flex' : 'none';
            });
        });
    }
});
</script>
</body>
</html>
